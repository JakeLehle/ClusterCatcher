# =============================================================================
# ClusterCatcher Pipeline Configuration
# =============================================================================
# This is a template configuration file for the ClusterCatcher single-cell
# RNA sequencing analysis pipeline.
#
# Generated by: create_config.py
# Documentation: https://github.com/yourusername/ClusterCatcher
#
# INSTRUCTIONS:
#   1. Copy this file and rename it (e.g., my_project_config.yaml)
#   2. Fill in all REQUIRED fields marked with "<REQUIRED>"
#   3. Adjust optional parameters as needed
#   4. Run: snakemake --configfile my_project_config.yaml --cores 8
#
# Alternatively, use the create_config.py script to generate this automatically:
#   python snakemake_wrapper/create_config.py --help
# =============================================================================

# =============================================================================
# OUTPUT DIRECTORIES
# =============================================================================

# Main output directory where all results will be written
# <REQUIRED>
output_dir: "/path/to/output"

# Log directory (auto-created under output_dir if not specified)
log_dir: null  # Defaults to {output_dir}/logs

# =============================================================================
# RESOURCE SETTINGS
# =============================================================================

# Number of threads to use per job
threads: 8

# Memory allocation in GB per job
memory_gb: 64

# =============================================================================
# SAMPLE SPECIFICATION
# =============================================================================
# Samples can be specified in two ways:
#   1. Using a sample pickle file (from sample-information command or SRAscraper)
#   2. Directly listing sample IDs (requires FASTQs in standard location)

# Path to sample pickle file containing sample dictionary
# Format: {sample_id: {fastq_r1: [...], fastq_r2: [...], ...}}
# <REQUIRED if sample_ids not provided>
sample_info: null  # "/path/to/samples.pkl"

# Direct list of sample IDs
# <REQUIRED if sample_info not provided>
sample_ids: []
  # - SAMPLE1
  # - SAMPLE2
  # - SAMPLE3

# Full sample dictionary (usually loaded from sample_info pickle)
# Can also be specified directly in YAML:
samples: {}
  # SAMPLE1:
  #   fastq_r1:
  #     - /path/to/SAMPLE1_S1_L001_R1_001.fastq.gz
  #   fastq_r2:
  #     - /path/to/SAMPLE1_S1_L001_R2_001.fastq.gz
  #   condition: tumor
  #   donor: P001

# =============================================================================
# REFERENCE FILES
# =============================================================================

reference:
  # Reference genome FASTA file
  # <REQUIRED>
  fasta: "/path/to/GRCh38/genome.fa"
  
  # Reference directory (parent of fasta file, auto-detected)
  dir: null  # Auto-set to parent of fasta
  
  # Cell Ranger reference directory
  # <REQUIRED>
  cellranger: "/path/to/refdata-gex-GRCh38-2020-A"
  
  # GTF annotation file (auto-detected from Cell Ranger reference if not specified)
  gtf: null  # "/path/to/genes.gtf"
  
  # Genome build (for mutation annotation)
  genome: "GRCh38"

# =============================================================================
# CELL RANGER SETTINGS
# =============================================================================

cellranger:
  # Chemistry version (auto-detect recommended)
  # Options: auto, SC3Pv2, SC3Pv3, SC3Pv3HT, SC5P-PE, SC5P-R2, ...
  chemistry: "auto"
  
  # Expected number of cells (used for cell calling)
  expect_cells: 10000
  
  # Include intronic reads (recommended for nuclear RNA)
  include_introns: false
  
  # Local cores for Cell Ranger (usually same as threads)
  localcores: 8
  
  # Local memory for Cell Ranger in GB
  localmem: 64
  
  # Create BAM output (required for downstream analysis)
  create_bam: true

# =============================================================================
# QUALITY CONTROL SETTINGS
# =============================================================================

qc:
  # Minimum genes detected per cell
  min_genes: 200
  
  # Minimum UMI counts per cell
  min_counts: 500
  
  # Maximum mitochondrial percentage
  max_mito_pct: 20
  
  # Expected doublet rate (for scrublet)
  doublet_rate: 0.08

# =============================================================================
# PREPROCESSING SETTINGS
# =============================================================================

preprocessing:
  # Target sum for normalization
  target_sum: 10000
  
  # Number of highly variable genes
  n_top_genes: 2000
  
  # Number of principal components
  n_pcs: 50
  
  # Number of neighbors for graph construction
  n_neighbors: 15
  
  # Leiden clustering resolution
  resolution: 1.0

# =============================================================================
# CELL ANNOTATION SETTINGS
# =============================================================================

annotation:
  # Annotation method
  # Options: popv, celltypist, sctype, leiden
  method: "popv"
  
  # Reference dataset or model for annotation
  # popv: null (uses default reference)
  # celltypist: model name or path
  # sctype: tissue type for sctype
  reference: null

# =============================================================================
# MODULE ENABLE/DISABLE FLAGS
# =============================================================================

modules:
  # Core modules (always enabled)
  cellranger: true
  qc: true
  annotation: true
  
  # Optional modules
  viral: false           # Viral detection with Kraken2
  dysregulation: true    # Cancer/dysregulated cell detection
  scomatic: false        # Somatic mutation calling
  signatures: false      # Mutational signature analysis

# =============================================================================
# VIRAL DETECTION SETTINGS (requires modules.viral: true)
# =============================================================================

viral:
  # Kraken2 database path
  # <REQUIRED if viral detection enabled>
  kraken_db: null  # "/path/to/kraken2_db"
  
  # Human viral database inspect.txt for filtering
  viral_db: null  # "/path/to/human_viral_db/inspect.txt"
  
  # Kraken2 confidence threshold (0.0 - 1.0)
  confidence: 0.1
  
  # Organisms to include (list of name patterns)
  include_organisms: null
  
  # Organisms to exclude (list of name patterns)
  exclude_organisms: null
  
  # Organisms of interest to highlight in reports
  organisms_of_interest: []

# =============================================================================
# DYSREGULATION DETECTION SETTINGS (requires modules.dysregulation: true)
# =============================================================================

dysregulation:
  # CytoTRACE2 settings (stemness/potency scoring)
  cytotrace2:
    enabled: true
    species: "human"  # human or mouse
    max_cells_per_chunk: 200000  # Chunk size for memory management
  
  # InferCNV settings (copy number variation)
  infercnv:
    enabled: true
    window_size: 250  # Sliding window for CNV detection
  
  # Reference cell types for inferCNV (non-cancer reference)
  # List cell type names that should be used as normal reference
  infercnv_reference_groups: null
    # - "T cells"
    # - "B cells"
    # - "Fibroblasts"
  
  # Agreement score settings (combining CytoTRACE2 and inferCNV)
  agreement:
    # Weight between rank-based (0) and value-based (1) agreement
    alpha: 0.5
    # Minimum Spearman correlation for quartile selection
    min_correlation: 0.5

# =============================================================================
# SCOMATIC MUTATION CALLING SETTINGS (requires modules.scomatic: true)
# =============================================================================

scomatic:
  # SComatic scripts directory
  # <REQUIRED if SComatic enabled>
  scripts_dir: null  # "/path/to/SComatic/scripts"
  
  # RNA editing sites file
  # <REQUIRED if SComatic enabled>
  editing_sites: null  # "/path/to/AllEditingSites.txt"
  
  # Panel of Normals file
  # <REQUIRED if SComatic enabled>
  pon_file: null  # "/path/to/PoN.tsv"
  
  # BED file for mappable regions
  # <REQUIRED if SComatic enabled>
  bed_file: null  # "/path/to/mappable_regions.bed"
  
  # Minimum coverage at position
  min_cov: 5
  
  # Minimum cells with variant
  min_cells: 5
  
  # Cell types to use (null = use all)
  cell_types: null
  
  # Base quality filter
  min_base_quality: 30
  
  # Mapping quality filter
  min_map_quality: 30

# =============================================================================
# SIGNATURE ANALYSIS SETTINGS (requires modules.signatures: true)
# =============================================================================

signatures:
  # COSMIC mutational signature database file
  # <REQUIRED if signature analysis enabled>
  cosmic_file: null  # "/path/to/COSMIC_v3.4_SBS_GRCh38.txt"
  
  # Core signatures to always include in analysis
  core_signatures:
    - "SBS2"   # APOBEC activity
    - "SBS13"  # APOBEC activity
    - "SBS5"   # Clock-like signature
  
  # Use scree plot method for signature selection
  use_scree_plot: true
  
  # Candidate signature ranking order (for iterative addition)
  candidate_order: null
    # - "SBS1"
    # - "SBS4"
    # - "SBS7a"
  
  # Minimum mutations per cell for inclusion
  mutation_threshold: 0
  
  # Maximum signatures to test
  max_signatures: 15
  
  # Use only HNSCC-relevant signatures
  hnscc_only: false
  
  # HNSCC-relevant signature list (if hnscc_only: true)
  hnscc_signatures:
    - "SBS1"
    - "SBS2"
    - "SBS4"
    - "SBS5"
    - "SBS7a"
    - "SBS7b"
    - "SBS13"
    - "SBS16"
    - "SBS17a"
    - "SBS17b"
    - "SBS18"
    - "SBS29"
    - "SBS39"
    - "SBS40"
    - "SBS44"

# =============================================================================
# ADVANCED SETTINGS
# =============================================================================

# Random seed for reproducibility
random_seed: 42

# Keep intermediate files (for debugging)
keep_intermediate: false

# Report generation settings
reports:
  generate_html: true
  generate_pdf: false
  figure_format: "png"  # png, pdf, svg
  figure_dpi: 150

# =============================================================================
# CLUSTER/HPC SETTINGS (for Snakemake profiles)
# =============================================================================

# These are typically set via Snakemake command line or profile, not here
# Included for reference only

# cluster:
#   partition: "normal"
#   time: "24:00:00"
#   mem: "64G"
#   qos: null

